<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html;charset=windows-1251">
</head>
<link rel="stylesheet" href="../STYLE.css">
<body TEXT="#000000" BGCOLOR="#E7E3E7" LINK="#004080" VLINK="#004080" olink="#008080" Background="">
<table BORDER=0   COLS=3 WIDTH="16%" >
  <tr> 
    <td><a href="Index3.html"><img SRC="Back.gif"  BORDER=0 ></a></td>
    <td WIDTH="10%"><a href="../menu.html"><img SRC="Menu.gif" BORDER=0 ></a></td>
    <td ALIGN=RIGHT><a href="Index5.html"><img SRC="For.gif" BORDER=0 ></a></td>
  </tr>
</table>

 
<br>
<table width="100%" border="0">
  <tr>
    <td class="Text_n">
 
<p class="Tit_CN">

Идентификация запущенных TCP- и UDP-служб</P>

<p class="Text_n">
Использование хорошей утилиты сканирования портов — важнейший этап сбора информации об исследуемой сети. Хотя для этих целей существует много различных программ, ориентированных как на платформу UNIX, так и на платформу Windows NT, мы ограничимся рассмотрением лишь самых популярных и проверенных временем сканеров.
<br>
<P align="center">
<span class="Text_b">
strobe</span></P>
<br>
<p class="Text_n">
Утилита strobe — это общепризнанный и популярный TCP-сканер портов, написанный Джулианом Ассанжем (Julian Assange) (<span class="Text_b">ftp://ftp.FreeBSD.org/pub/ FreeBSD/ports/distfiles/strobe-l.06.tgz</span>). Она стала известной уже довольно давно и, вне всякого сомнения, считается одной из самых быстрых и надежных утилит этого класса. К основным возможностям утилиты strobe относится оптимизация системных и сетевых ресурсов, а также сканирование исследуемой системы с максимальной эффективностью. Помимо высокой эффективности, утилита strobe версии 1.04 и выше может собирать идентификационные маркеры (если, конечно, они имеются), связанные
с каждым проверяемым портом. Эта информация может оказаться полезной при определении операционной системы, а также запущенных на компьютере службах. Подробнее процесс сбора маркеров (banner grabbing) будет рассматриваться в главе 3.
<br>

В данных, выводимых утилитой strobe, имеется информация о каждом прослушанном порте TCP.
<br>
<p class="Code">
[tsunami] <span class="Text_b">strobe 192.168.1.10</span><br>
strobe 1.03 © 1995 Julian Assange (proff@suburbia.net).<br>
192.168.1.10 echo 7/tcp Echo [95,JBP]<br>
192.168.1.10 discard 9/tcp Discard [94,JBP]<br>
192.168.1.10 sunrpc 111/tcp rpcbind SUN RFC<br>
192.168.1.10 daytime 13/tcp Daytime [93,JBP]<br>
192.168.1.10 chargen 19/tcp ttytst source<br>
192.168.1.10 ftp 21/tcp File Transfer [Control] [96,JBP]<br>
192.168.1.10 exec 512/tcp remote process execution;<br>
192.168.1.10 login . 513/tcp remote login a la telnet;<br>
192.168.1.10 cmd 514/tcp shell like exec, but automatic<br>
192.168.1.10 ssh 22/tcp Secure Shell<br>
192.168.1.10 telnet 23,/tcp Telnet [112,JBP]<br>
192.168.1.10 smtp 25/tcp Simple Mail Transfer [102,JBP]<br>
192.168.1.10 nfs 2049/tcp networked file system<br>
192.168.1.10 lockd 4045/tcp<br>
192.168.1.10 unknown 32772/tcp unassigned<br>
192.168.1.10 unknown 32773/tcp unassigned<br>
192.168.1.10 unknown 32778/tcp unassigned<br>
192.168.1.10 unknown 32799/tcp unassigned<br>
192.168.1.10 unknown 32804/tcp unassigned<br>
</p>

Хотя в большинстве случаев утилита strobe предоставляет точные данные, все же важно помнить о некоторых ее ограничениях. Во-первых, данная утилита выполняет TCP-сканирование, не поддерживая сканирование по протоколу UDP. Поэтому в некоторых случаях можно получить лишь половину требуемой информации. Во-вторых, при соединении с каждым портом утилита strobe выполняет лишь TCP-сканирование подключением. Хотя именно этим и объясняется высокая надежность получаемых результатов, в то же время использование утилиты strobe очень легко выявить на исследуемой системе. Поэтому необходимо рассмотреть и другие утилиты сканирования, лишенные указанных недостатков.
<br>
<P align="center">
<span class="Text_b">
udp_scan</span></P>
<br>
<p class="Text_n">
Для UDP-сканирования, которого не выполняет strobe, можно воспользоваться утилитой udp_scan, которая изначально входила в пакет SATAN (Security Administrator Tool for Analyzing Networks), написанный Дэном Фармером (Dan Farmer) и Вайетсом Венема (Wietse Venema) в 1995 году. Хотя сам пакет SATAN несколько устарел, входящие в его состав утилиты по-прежнему можно использовать. Кроме того, по адресу
<span class="Text_b"> http://wwdsilx.wwdsi.com </span> можно получить новую версию пакета SATAN, которая теперь называется SAINT. Несмотря на наличие множества других утилит UDP-сканирования, мы пришли к выводу, что udp_scan — одна из самых надежных утилит, позволяющая получать достоверные результаты. Правда, необходимо сказать также о том, что, несмотря на высокую надежность утилиты udp_scan, у нее имеется и один существенный недостаток. Эта утилита не может противостоять контратаке какого-либо из пакетов IDS, который осведомлен о методах, используемых в пакете
SATAN для сканирования портов. Таким образом, если сканирование необходимо выполнить более скрытно, поишите какое-нибудь другое средство. Обычно с помощью утилиты udp_scan проверяются порты с номерами, меньшими 1024, а также некоторые определенные порты с большими номерами.
<br>
<p class="Code">
;tsunami] <span class="Text_b">udp_scan 192.168.1.1 1-1024</span><br>
-: 2 : UNKNOWN: 5 3:UNKNOWN: 123:UNKNOWN: 135:UNKNOWN:<br>
</p>
<p align="center">
<span class="Text_b">
netcat</span></P>
<br>
<p class="Text_n">
Еще одной прекрасной утилитой является netcat (или
nc), написанная Хоббитом (Hobbit, <span class="Text_b"> hobbit@avian.org</span>). Эта утилита может выполнять так много различных задач, что была названа нами &quot;швейцарским армейским ножом&quot;. Помимо остальных возможностей, о которых мы еще не раз будем говорить на протяжении всей книги, утилита
nc позволяет применять основные методы TCP- и UDP-сканирования. Степенью детализации выводимых данных можно управлять с помощью параметров -v и


-vv, которые включают, соответственно, режимы подробного и очень подробного отображения результатов. Параметр -z применяется для включения режима нулевого ввода-вывода (zero mode I/O), используемого для сканировании портов, а параметр -..2 позволяет задать для каждого соединения интервал ожидания. По умолчанию утилита пс выполняет TCP-сканирование, а для UDP-сканирования необходимо использовать параметр -и (как показано во втором примере).
<br>
<p class="Code">
tsunami]  <span class="Text_b">nc -v -z -w2 192.168.1.1 1-140</span><br>
192.168.1.1] 139 (?) open<br>
192.168.1.1] 135 (?) open<br>
192.168.1.1] 110 (pop-3) open<br>
[192.168.1.1] 106 (?) open<br>
[192.168.1.1] 81 (?) open<br>
[192.168.1.1] 80 (http) open<br>
[192.168.1.1] 79 (finger) open<br>
[192.168.1.1] 53 (domain) open<br>
[192.168.1.1] 42 (?) open<br>
[192.168.1.1] 25 (smtp) open<br>
[192.168.1.1] 21 (ftp) open<br>
[tsunami]  <span class="Text_b">nc -u -v -z -w2 192.168.1.1 1-140</span><br>
[192.168.1.1] 135 (ntportmap) open <br>
[192.168.1.1] 123 (ntp) open <br>
[192.168.1.1] 53 (domain) open <br>
[192.168.1.1] 42 (name) open<br>
</p>
<p align="center"><span class="Text_b">
nmap</span></P>
<br>
<p class="Text_n">
Рассмотрев простейшие средства сканирования портов, давайте перейдем к обсуждению возможностей безусловного лидера этой категории — утилиты nmap. Данная утилита, разработанная Федором (Fyodor)
(<span class="Text_b">http://www.insecure.org/nmap</span>), обладает не только базовыми возможностями TCP- и UDP-сканирования, но и поддерживает все остальные упоминавшиеся выше методы. Очень редко можно найти утилиту, которая предоставляла бы столь богатый набор возможностей в одном пакете. Итак, запустим утилиту и посмотрим, какие возможности она предоставляет.
<br>
<p class="Code">
[tsunami]# <span class="Text_b">nmap -h</span><br>
nmap V. 2.53 Использование: <br>nmap [Тип(ы) сканирования] [Параметры]<br>
&lt;Список узлов или подсетей&gt;<br>
Некоторые стандартные типы сканирования <br>(При использовании параметров,
отмеченных символом '*',<br> требуются привилегии root)<br>
-sT TCP-сканирование подключением <br>(устанавливается по умолчанию)
* -sS TCP-сканирование<br>с помощью сообщений SYN <br>(среди всех методов TCP-сканирования является наилучшим)<br>
* -sU UDP-сканирование<br>
-sP ping-прослушивание <br>(выполняется поиск всех достижимых узлов)<br>
* -sF,-sX,-sN сканирование с помощью сообщений FIN,<br> по методу &quot;рождественской елки&quot; и<br> нуль-сканирование,<br>
соответственно (рекомендуется<br> использовать только опытным пользователям)<br>
-SR/-I сканирование с использованием демона <br>RPC/identd (применяется совместно с другими типами<br> сканирования)<br>
 Некоторые стандартные параметры<br> (являются необязательными, могут комбинироваться друг с другом):<br>
* -О режим изучения пакетов TCP/IP <br>с целью определения типа удаленной операционной системы<br>
-р &lt;диапазон&gt; — диапазон портов, <br>которые будут сканироваться. <br>
Пример диапазона: '1-1024,1080,6666,31337'<br>
-F Выполняется сканирование портов,<br> перечисленных в файле /etc/services<br>
-v Режим вывода подробной информации.<br>Рекомендуется всегда использовать этот параметр.<br>
 Для включения режима вывода очень <br>подробной информации используйте параметр -vv<br>
-РО Отключение проверки активности узла <br>с помощью утилиты ping (применяется <br>для сканирования таких узлов,<br>
как www.microsoft.com и аналогичных)<br>
* -Ddecoy_hostl,decoy2[,...] <br>Скрытое сканирование с указанием нескольких ложных адресов узлов<br>
-Т &lt;Paranoici I Sneaky|Polite|Normal[Aggressive IInsane&gt;<br>
 Принятая политика ожидания<br> отклика от удаленного узла<br>
-n/-R Никогда не выполнять разрешение имен DNS/<br>Всегда выполнять [по умолчанию: имена разрешаются<br> при необходимости]
-oN/-oM &lt;logfile&gt; <br>Вывести результаты сканирования в файл &lt;logfile&gt; в<br> удобочитаемом/машинном формате
-iL &lt;inputfile&gt;<br> Взять IP-адреса или имена узлов из файла &lt;inputfiie&gt;.<br>
 Для использования стандартного потока ввода stdin укажите '-'<br>
* -S &lt;your_IP&gt;/-e &lt;devicename&gt;<br> позволяет указать исходный IP-адрес или устройство<br>
--переход в интерактивный режим<br> (затем для получения справки нужно нажать клавишу h)<br>
[tsunami] <span class="Text_b">nmap -sS 192.168.1.1</span><br>
Starting nmap V. 2.53 by fyodor@insecure.org <br>
Interesting ports on  (192.168.1.11):<br>
(The 1504 ports scanned but <br>not shown below are in state: closed)<br>
Port State Protocol  Service<br>
21 open tcp ftp<br>
25 open tcp smtp<br>
42 open tcp nameserver<br>
53 open tcp domain<br>
79 open tcp finger<br>
80 open tcp http<br>
81 open tcp hosts2-ns<br>
106 open tcp popSpw<br>
110 open tcp pop-3<br>
135 open tcp loc-srv<br>
139 open tcp netbios-ssn<br>
443 open tcp https<br>
</p>

Помимо вышеуказанных, утилита nmap предоставляет и другие полезные возможности, заслуживающие детального обсуждения. Так, в приведенном выше примере мы ис-ПОЛЬЗОЕИЛИ параметры командной строки, при которых осуществлялось сканирование одного узла. Однако утилита nmap с такой же легкостью позволяет сканировать и всю сеть. Как легко заметить, nmap поддерживает описания диапазонов адресов в нотации CIDR (Classless Inter-Domain Routing — бесклассовая маршрутизация доменов Internet), описанной в RFC 1519
(<span class="Text_b">http://www.ietf.org/rfc/rfcl519.txt</span>). В этом формате очень легко задавать диапазоны адресов вида 192.168.1.1-192.168.1.254. Полученную информацию можно сохранить в обычном текстовом файле с помощью параметра -о. При указании параметра -oN результаты будут сохранены в удобочитаемом формате.
<br>

<span class="Text_b">
[tsunar.i]#  ranap  -sF  192.168.1.0/24   -oN outfile</span>
<br>

Если выводимые данные нужно сохранить в файле, в котором в качестве разделителей используются символы табуляции (например, чтобы впоследствии программно анализировать полученную информацию), используйте параметр -оМ. В любом случае при сканировании сети, скорее всего, будет получено очень много информации, поэтому имеет смысл сохранить результаты в любом из форматов. В некоторых случаях целесообразно сохранять их сразу в обоих форматах, используя как параметр -ON, так и -оM.
<br>

Предположим, что после сбора предварительных данных о сети организации мы пришли к выводу, что в качестве основного брандмауэра в ней используется простое устройство, выполняющее фильтрацию пакетов. В этом случае можно воспользоваться параметром -f утилиты nmap, чтобы включить режим фрагментации пакетов. Очевидно, что это приведет к отделению заголовков TCP-пакетов от самих пакетов, что затруднит для устройств управления доступом или систем IDS возможность выявления попытки сканирования. В большинстве случаев современные устройства фильтрации пакетов и брандмауэры прикладного уровня, прежде чем осуществлять анализ пакетов IP, помещают все фрагменты в очередь. Однако при использовании более старых моделей устройств управления доступом или устройств, в которых соответствующие функции были отключены для повышения производительности, дефрагментация не выполняется и пакеты передаются дальше во внутреннюю сеть в том виде, в котором они поступают.
<br>

Если архитектура системы безопасности исследуемой сети и ее узлов была хорошо продумана, то эта система без особого труда выявит сканирование, осуществляемое с помощью приведенных выше примеров. Для таких случаев утилита nmap предоставляет дополнительные возможности маскирования, предназначенные для заполнения системных журналов исследуемого узла избыточной информацией. Данный режим включается с помощью параметра -D. Главная идея данного подхода состоит в том, чтобы во время выполнения реального сканирования создать видимость одновременного сканирования из других указанных в командной строке адресов. Для того чтобы воспрепятствовать такому сканированию, системе безопасности исследуемого узла придется проверить все записи, чтобы выяснить, какие из полученных IP-адресов источников сканирования являются реальными, а какие — фиктивными. При использовании данного метода нужно удостовериться в том, что IP-адреса, выступающие в качестве маскировочных, принадлежат реальным узлам, которые в момент сканирования подключены к Internet. В противном случае исследуемая система будет не в состоянии обработать все сообщения SYN, в результате чего возникнет условие DoS.
<br>
<p class="Code">
[tsunami] <span class="Text_b">nmap -sS  192.168.1.1 -D 10.1.1.1</span><br>
www.target_web.com,ME -p25,139,443<br>
Starting nmap V. 2.53 by fyodor@insecure.org <br>Interesting ports on  (192.168.1.1):<br>
Port State '  Protocol Service<br>
25 open tcp smtp<br>
443 open tcp https<br>
Nmap run completed -- 1 IP address (1 host up) scanned in 1 second<br>
</p>

В приведенном примере параметры, введенные в командной строке утилиты nmap, обеспечивают сканирование в режиме, затрудняющем обнаружение реального адреса сканирующего узла.
<br>

Еще одним полезным методом является сканирование с целью идентификации запущенных процессов (подробнее о нем говорится в RFC 1413,
<span class="Text_b">http://www.ieff.org/rfc/rfcl413.txt</span>). Этот тип сканирования, называемый ident-сканированием, предназначен для определения пользователя путем установления TCP-соединения с портом 113. Очень часто в ответ приходит сообщение, содержащее идентификатор владельца процесса, связанного с данным портом. Однако этот метод годится лишь для исследования систем UNIX.
<br>
<p class="Code">
[tsunami]  <span class="Text_b">nmap -I 192.168.1.10</span><br>
Starting nmap V. 2.53 by fyodor@insecure.org<br>
Port    State Protocol  Service        Owner<br>
22     open tcp       ssh            root<br>
25      open tcp       smtp           root<br>
80      open tcp       http           root<br>
110    open tcp       pop-3          root<br>
113    open tcp       auth           root<br>
6000    open tcp       Xll            root<br>
</p>

В приведенном выше фрагменте показано, как идентифицируются владельцы всех обнаруженных процессов. Опытный читатель должен обратить внимание на то, что Web-сервер принадлежит не пользователю nobody, как это должно быть в соответствии с элементарными правилами обеспечения безопасности, а пользователю root, что является вопиющим нарушением. Выполнив идентификацию процессов и установив такой интересный факт, можно заключить, что взломщик, которому удастся проникнуть через систему защиты Web-сервера, получит полный контроль над данным компьютером.
<br>

Последний метод, на котором мы остановимся, называется сканированием с прорывом по FTP (FTP bounce scanning). Этот метод впервые был описан Хоббитом (Hobbit). В своей статье, опубликованной в электронном бюллетене Bugtraq в 1995 году, он осветил некоторые скрытые недостатки протокола FTP (RFC 959,
<span class="Text_b">http://www.ietf.org/rfc/rfc0959.txt</span>). Кратко данный метод можно описать как скрытное подключение через FTP-сервер, используя поддержку proxy-серверов, реализованную на этом FTP-сервере. Как отмечает Хоббит в вышеупомянутой статье, прорыв по FTP &quot;можно использовать практически для неотслеживаемой отправки электронной почты и сообщений в группы новостей, взлома серверов различных сетей, заполнения диска, попыток прорыва через брандмауэры и другой вредоносной деятельности, которая при этом может оставаться практически незамеченной&quot;. Добавим, что с помощью прорыва по FTP можно сканировать порты, чтобы скрыть свой адрес, и, что еще более важно, обходить устройства управления доступом.
<br>

Конечно, утилита nmap поддерживает и этот режим сканирования (параметр -b). Однако для его выполнения необходимо соблюдение нескольких условий. Во-первых,
на FTP-сервере должен быть каталог, доступный для чтения/записи со стороны любого пользователя, например /incoming. Во-вторых, FTP-сервер должен принять от утилиты nmap заведомо неправильную информацию о порте с помощью команды PORT. Хотя этот метод очень эффективен для проникновения через устройства управления доступом, а также для сокрытия своего адреса, у него есть один существенный недостаток — слишком низкая скорость работы. Кроме того, многие современные FTP-серверы просто запрещают выполнение таких операций.
<br>

Однако применение различных средств для сканирования портов — это только половина задачи. Теперь нужно разобраться с тем, как проанализировать данные, полученные с помощью каждой из утилит. Независимо от применяемого средства, необходимо идентифицировать открытые порты, поскольку их перечень позволит определить операционную систему удаленного узла. Например, если на узле открыты порты 135 и 139, то, скорее всего, этот узел работает под управлением операционной системы Windows NT. Обычно Windows NT опрашивает порты 135 и 139, тогда как Windows 95/98 — лишь порт 139.
<br>

Например, изучив результаты, полученные во время работы утилиты strobe, которая рассматривалась выше в этой главе, можно заключить, что исследовавшийся в рассматриваемом примере узел работает под управлением операционной системы из семейства UNIX. Данный вывод можно сделать на основании того, что на исследуемом узле открыты порты с номерами 111 (portmapper), 512-514 (службы Berkley R), 2049 (NFS), а также порты с номерами 3277Х, что характерно именно для систем семейства UNIX. Более того, можно также предположить, что данная операционная система относится к семейству Solaris — именно этой системе присуще использование служб RPC вместе с портам из этого диапазона. Нужно подчеркнуть, что это лишь предположения, поскольку в действительности установленная операционная система, если с ее настройкой поработал опытный администратор безопасности, может лишь &quot;выдавать себя&quot; за Solaris, а в действительности не иметь с ней ничего общего.
<br>

Итак, после завершения TCP- и (или) UDP-сканирования портов уже можно выдвинуть предположения о типе операционной системы, работающей на исследуемом узле, и, следовательно, о том, как можно проникнуть на этот узел. Например, если на сервере Windows NT открыт порт 139, то такой узел подвергается очень высокой степени риска. Подробнее о скрытых недостатках системы защиты Windows NT, а также о том, как с помощью порта 139 можно проникнуть в систему, в которой не приняты адекватные контрмеры для защиты этого порта, рассказывается в главе 5. Рассматривавшаяся в качестве примера система UNIX, скорее всего, также подвергается большому риску, поскольку выявленные нами работающие службы предоставляют в распоряжение удачливого взломщика очень большие возможности. Например, использование служб удаленного вызова процедур (RPC — Remote Procedure Call) и поддержки сетевой файловой системы (NFS — Network File System) являются двумя основными методами проникновения через систему защиты сервера UNIX (подробнее см. главу 8). С другой стороны, если служба RPC не находится в режиме ожидания запросов, то проникнуть через ее систему защиты практически невозможно. Именно поэтому так важно помнить, что чем больше служб работает на компьютере, тем большему риску он подвергается.
<br>


</p></td>
  </tr>
</table>
<br>
<table BORDER=0  COLS=3 WIDTH="11%" >
  <tr> 
   <td><a href="Index3.html"><img SRC="Back.gif"  BORDER=0 ></a></td>
    <td WIDTH="10%"><a href="../menu.html"><img SRC="Menu.gif" BORDER=0 ></a></td>
    <td ALIGN=RIGHT><a href="Index5.html"><img SRC="For.gif" BORDER=0 ></a></td>
   
  </tr>
</table>
</body>
</html>
