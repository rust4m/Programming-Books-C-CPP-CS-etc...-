<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html;charset=windows-1251">
</head>
<link rel="stylesheet" href="../STYLE.css">
<body TEXT="#000000" BGCOLOR="#E7E3E7" LINK="#004080" VLINK="#004080" olink="#008080" Background="">
<table BORDER=0   COLS=3 WIDTH="16%" >
  <tr> 
    <td><a href="Index12.html"><img SRC="Back.gif"  BORDER=0 ></a></td>
    <td WIDTH="10%"><a href="../menu.html"><img SRC="Menu.gif" BORDER=0 ></a></td>
    <td ALIGN=RIGHT><a href="Index14.html"><img SRC="For.gif" BORDER=0 ></a></td>
  </tr>
</table>

 
<br>
<table width="100%" border="0">
  <tr>
    <td class="Text_n">
 
<p class="Tit_CN">

Набор Rootkit — полный взлом системы</P>

<p class="Text_n">
А что, если даже сам код операционной системы окажется под контролем взломщика? Эта идея достаточно хорошо опробована для платформы UNIX. Закономерно, что для замены стандартных исполняемых файлов &quot;троянскими конями&quot; обычно требуется получить учетную запись root системы UNIX на целевом компьютере. Наборы программ, выполняющих эту операцию, получили название &quot;отмычек&quot;. &quot;Отмычки&quot;, применяемые в UNIX, подробно рассматриваются в главе 8, а обсуждение &quot;отмычек&quot; вообще можно найти в главе 14.
<br>
<P align="center"><span class="Text_b">Отмычки&quot; NT/2000</span></P>
<br>
<p class="Text_n">
Нет ничего удивительного в том, что в 1999 году благодаря группе Грега Хогланда (Greg Hogland,<span class="Text_b">
http://www.rootkit.com</span>) система Windows NT/2000 &quot;приобрела&quot; свой собственный набор &quot;отмычек&quot;. Грег застал врасплох сообщество Windows, продемонстрировав рабочий прототип таких инструментов, который способен выполнять сокрытие параметров системного реестра и &quot;подмену&quot; исполняемых файлов. Этот набор можно использовать в исполняемых файлах &quot;троянских коней&quot; без изменения их содержимого. Все эти трюки основываются на использовании перехвата функций (function hooking). Таким образом можно &quot;модифицировать&quot; ядро NT, в результате чего будут захвачены системные вызовы. С помощью набора &quot;отмычек&quot; можно скрыть процесс, параметр системного реестра или файл, а также перенаправить перехваченный вызов функциям &quot;троянских коней&quot;. Полученный результат способен превзойти ожидания от внедрения &quot;троянских коней&quot;: пользователь не может быть уверен даже в целостности исполняемого кода.
<br>

В момент написания этой книги набор &quot;отмычек&quot; систем NT/2000 по-прежнему оставался на стадии альфа-версии и в основном предназначался для демонстрации наиболее важных особенностей, а не для реального применения. Распространяемый комплект состоит из двух файлов: _root_.sys и deploy.exe. При запуске файла deploy.exe набор &quot;отмычек&quot; будет установлен и запущен.
<br>

После установки активизируется режим сокрытия параметров системного реестра. Любой параметр или значение, начинающиеся с шести символов _root_, будут скрыты для просмотра с помощью любого из редакторов regedit.exe или regedt32.exe. Любой исполняемый файл, имя которого будет начинаться с _root_, не будет виден. С помощью копии редактора системного реестра regedit.exe, переименованной в файл _root_regedit.exe, можно просмотреть все скрытые параметры. Тем самым взломщику предоставляется прекрасный &quot;потайной ход&quot;, с использованием которого можно приступить к ручной работе без отключения режима маскирования &quot;набора отмычек&quot;.
<br>

В альфа-версии средство перенаправления исполняемых файлов позволяет выявлять выполнение файлов с именами, начинающимися с _root_, и перенаправлять их результаты файлу С: \calc.exe (жестко заданный режим, не позволяющий взломщику немедленно получить долгожданную информацию, однако наглядно демонстрирующий его потенциальную злонамеренность).
<br>

Грег также распространяет консоль удаленного управления RogueX из набора &quot;отмычек&quot; с изящным интерфейсом. Она находится на стадии разработки и имеет ограниченные функциональные возможности (в частности, позволяет инициировать сканирование портов удаленного узла, на котором установлен набор &quot;отмычек&quot;).
<br>
<P align="center">
<span class="Text_b">
Контрмеры: защита от набора &quot;отмычек&quot;</span></P>
<br>
<p class="Text_n">
Если вы не можете доверять даже команде dir, значит, пришло время признать себя побежденным: создайте резервную копию важных данных (кроме двоичных файлов!), удалите все программное обеспечение и переустановите его с проверенных носителей. На полагайтесь на резервные копии, поскольку неизвестно, в какой момент взломщик получил контроль над системой, — вы можете восстановить тех же самых &quot;троянских коней&quot;.
<br>

Сейчас важно подчеркнуть одно из золотых правил обеспечения безопасности и восстановления после сбоев: известные состояния (known states) и повторяемость (repeatability). Производственные системы зачастую должны быть быстро переустановлены, так что хорошо документированная и достаточно автоматизированная процедура установки позволит сэкономить много времени. Наличие проверенных носителей, готовых для выполнения процедуры восстановления, также достаточно важно. Если под рукой имеется компакт-диск с полностью сконфигурированным образом Web-сервера, то выигрыш во времени окажется еще более значительным. Другим хорошим приемом является документирование процесса настройки производственного режима эксплуатации, а не промежуточного режима, поскольку в процессе построения системы или ее обслуживания могут появиться изъяны в системе защиты (появления новых совместно используемых ресурсов и т.д.). Убедитесь, что в вашем распоряжении имеется контрольный список или автоматизированный сценарий возврата в производственный режим.
<br>

Подсчет контрольных сумм также оказывается хорошей защитой против использования наборов &quot;отмычек&quot;, однако этот прием нужно применять к системе в исходном состоянии (т.е. такой подход представляет собой превентивную меру, которая окажется бесполезной после возникновения неприятностей). Средства, подобные свободно распространяемой утилите MDSsum, способны &quot;снимать&quot; образы файлов и уведомлять о нарушении их целостности при возникновении изменений. Для системы Windows двоичный код утилиты MDSsum можно найти по адресу
<span class="Text_b"> http: //sourceware.cygnus.com/cygwin/</span>. С ее помощью для файла можно вычислить или проверить профильное сообщение (message digest) длиной 128 бит. При этом применяется популярный алгоритм MD5 Рона Райвеста (Ron Rivest) из лаборатории MIT Laboratory for Computer Science and RSA Security. Этот алгоритм описан в документе RFC 1321. В следующем примере утилита MDSsum показана в работе в процессе генерации контрольной суммы для файла с последующей ее проверкой.
<br>
<p class="Code">
D:\Toolbox&gt;<span class="Text_b">md5sum d:\test.txt &gt; d:\test.md5</span><br>
D:\Toolbox&gt;cat d:\test.md5<br>
efd3907b04b037774d831596f2clbl4a  d:\Xtest.txt<br>
D:\Toolbox&gt;md5sum —check d:\test.md5<br>
d:\Xtest.txt: OK<br>
</p>

К сожалению, утилита MDSsum одновременно работает лишь с одним файлом (конечно, использование сценариев несколько смягчает это неудобство).
<br>

К более эффективным средствам выявления вторжений в файловую систему относится хорошо известная утилита Tripwire, которую можно найти по адресу http://www.tripwire.com. С ее помощью можно выполнить аналогичный подсчет контрольных сумм для широкого диапазона систем.
<br>
<p class="Prim">
Перенаправление исполняемых файлов, выполняемое набором &quot;отмычек&quot; системы NT/2000, теоретически может нейтрализовать подсчет контрольных сумм. Однако поскольку код при этом не изменяется, но в то же время &quot;захватывается&quot; и передается через другую программу, то такой прецедент все же можно выявить.
</p>

Необходимо упомянуть еще несколько важных утилит, предназначенных для проверки содержимого двоичных файлов. К ним относится старая утилита UNIX strings, перенесенная на платформу Windows (также разработана компанией Cygnus), BinText от Робина Кейра&nbsp;
и мощный редактор текста/ шестнадцатеричных данных UltraEdit32 для Windows, который можно найти по адресу
<span class="Text_b"> http: //www.ultraedit.com</span>. Мы считаем, что редактор BinText лучше всего поместить в папку SendTo, так чтобы его можно было активизировать при щелчке правой кнопкой мыши на имени файлов в проводнике Windows. Для этих же целей редактор UltraEdit32 помещает в контекстное меню соответствующую команду.
<br>

И наконец, относительно набора &quot;отмычек&quot; NT/2000 Греша можно сказать, что наличие файлов deploy.exe и _root_.sys служит явным подтверждением нападения (или как минимум любознательности хозяина компьютера). К счастью, запуск и завершение набора &quot;отмычек&quot; можно выполнить с использованием команды net.
<br>
<p class="Code">
<span class="Text_b">net start _root_ <br>
net stop _root_</span><br>
</p>
<p class="Prim">
В Windows 2000 появилось средство защиты файлов операционной системы (Windows File Protection), которое предотвращает перезапись системных файлов, установленных программой инсталляции Windows 2000 (для этого около 600 файлов хранится в папке %systemroot%). В последних сообщениях, появившихся в бюллетене NTBugtraq, содержится информация о том, что систему WFP можно обойти, особенно, если ранее были получены привилегии администратора.
</p>


</p></td>
  </tr>
</table>
<br>
<table BORDER=0  COLS=3 WIDTH="11%" >
  <tr> 
   <td><a href="Index12.html"><img SRC="Back.gif"  BORDER=0 ></a></td>
    <td WIDTH="10%"><a href="../menu.html"><img SRC="Menu.gif" BORDER=0 ></a></td>
    <td ALIGN=RIGHT><a href="Index14.html"><img SRC="For.gif" BORDER=0 ></a></td>
   
  </tr>
</table>
</body>
</html>
