<html>
<head>
<meta http-equiv="Content-Language" content="ru">
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>
Глава 1
</title>
</head>
<body BGCOLOR="#E7E3E7" TEXT="#000000" LINK="#004080" VLINK="#004080" Background=" ">
<font  face="Verdana, Arial, Helvetica, sans-serif"><table width="14%" border="0" cellspacing="0">
<tr>
<td width="9%">
<font face="Verdana, Arial, Helvetica, sans-serif">
<a href="Index2.htm">
<img src="Back.gif" border="0" width="73" height="22">
</a>
</font>
</td>
<td width="45%">
<font face="Verdana, Arial, Helvetica, sans-serif">
<a href="../index.html">
<img src="Menu.gif" border="0" width="73" height="22">
</a>
</font>
</td>
<td width="46%">
<font face="Verdana, Arial, Helvetica, sans-serif">
<a href="Index4.htm">
<img src="For.gif" border="0" lowsrc="Index4.htm" width="73" height="22">
</a>
</font>
</td>
</tr>
</table>
<b>
<font face="Verdana, Arial, Helvetica, sans-serif">
<p>
<font size="4" face="Verdana, Arial, Helvetica, sans-serif">
Взлом парольной защиты операционной системы Windows NT
</font>
</p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">База данных учетных записей пользователей
</font></p>
</font>
</b>
<font face="Verdana, Arial, Helvetica, sans-serif" size="3">
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Одним из основных компонентов системы безопасности Windows NT является 
<i>
диспетчер учетных записей 
</i>
пользователей. Он обеспечивает взаимодействие 
других компонентов системы безопасности, приложений и служб Windows NT с базой 
данных учетных записей пользователей (Security Account Management Database, SAM). 
Эта база обязательно имеется на каждом компьютере с операционной системой 
Windows NT. В ней хранится вся информация, используемая для аутентификации пользователей Windows NT при 
интерактивном входе в систему и при удаленном доступе к ней по компьютерной 
сети.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">База данных SAM представляет собой один из кустов (hive) системного реестра (registry) 
Windows NT. Этот куст принадлежит ветви (subtree) HKEY_LOCAL_MACHINE и 
называется SAM. Он располагается в каталоге \wmnt_root\System32\ConfIg (winnt_root 
— условное обозначение каталога с системными файлами Windows NT) в отдельном 
файле, который тоже называется SAM.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Информация в базе данных SAM хранится в основном в двоичном виде. Доступ к 
ней обычно осуществляется через диспетчер учетных записей. Изменять записи, 
находящиеся в базе данных SAM, при помощи программ, позволяющих напрямую 
редактировать реестр Windows NT (REGEDT или REGEDT32), не рекомендуется. По 
умолчанию этого и нельзя делать, т. к. доступ к базе данных SAM запрещен для 
всех без исключения категорий пользователей операционной системы Windows NT.
</font></p>
</font>
<font face="Verdana, Arial, Helvetica, sans-serif">
<b>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Хранение паролей пользователей
</font></p>
</b>
</font>
<font face="Verdana, Arial, Helvetica, sans-serif" size="3">
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Именно в учетных записях базы данных SAM находится информация о 
пользовательских именах и паролях, которая необходима для идентификации и 
аутентификации пользователей при их интерактивном входе в систему. Как и в любой 
другой современной многопользовательской операционной системе, эта информация 
хранится в зашифрованном виде. В базе данных SAM каждый пароль пользователя 
обычно бывает представлен в виде двух 16-байтовых последовательностей, 
полученных разными методами.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">При использовании первого метода строка символов пользовательского пароля 
хэшируется с помощью функции MD4. В итоге из символьного пароля, введенного 
пользователем, получается 
16-байтовая последовательность — хэшированный пароль Windows NT. Данная 
последовательность затем шифруется по DES-алгоритму5, и результат шифрования 
сохраняется в базе данных SAM. При этом в качестве ключа используется так 
называемый относительный идентификатор пользователя (Relative Identifier, 
RID), который представляет собой автоматически увеличивающийся порядковый номер учетной 
записи данного пользователя в базе данных SAM.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Для совместимости с другим программным обеспечением корпорации Microsoft (Windows 
for Workgroups, Windows 95/98 и Lan Manager) в базе данных SAM хранится также 
информация о пароле пользователя в стандарте Lan Manager. Для ее формирования 
используется второй метод. Все буквенные символы исходной строки 
пользовательского пароля приводятся к верхнему регистру, и, если пароль содержит 
меньше 14 символов, то он дополняется нулями. Из каждой 7-байтовой половины 
преобразованного таким образом пароля пользователя отдельно формируется ключ для 
шифрования фиксированной 8-байтовой последовательности по DES-алгоритму. 
Полученные в результате две 8-байтовые половины хэшированного пароля Lan Manager 
еще раз шифруются по DES-алгоритму (при этом в качестве ключа используется RID 
пользователя) и помещаются в базу данных SAM.
</font></p>
</font>
<font face="Verdana, Arial, Helvetica, sans-serif">
<b>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Использование пароля
</font></p>
</b>
</font>
<font face="Verdana, Arial, Helvetica, sans-serif" size="3">
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Информация о паролях, занесенная в базу данных SAM, служит для аутентификации 
пользователей Windows NT. При интерактивном или сетевом входе в систему 
введенный пользователем пароль сначала хэшируется и шифруется, а затем 
сравнивается с 16-байтовой последовательностью, записанной в базе данных SAM. 
Если они совпадают, пользователю разрешается вход в систему.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Обычно в базе данных SAM хранятся в зашифрованном виде оба хэшированных 
пароля. Однако в некоторых случаях операционная система вычисляет только один из 
них. Например, если пользователь домена Windows NT изменит свой пароль, работая 
на компьютере с Windows for Workgroups, то в его учетной записи останется только 
пароль Lan Manager. А если пользовательский пароль содержит более 14 символов 
или если эти символы не входят в так называемый 
<i>
набор поставщика оборудования
</i>
(original equipment manufacturer, OEM), то в базу данных SAM будет занесен 
только пароль Windows NT.
</font></p>
</font>
<font face="Verdana, Arial, Helvetica, sans-serif">
<b>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Возможные атаки на базу данных SAM
</font></p>
</b>
</font>
<font face="Verdana, Arial, Helvetica, sans-serif" size="3">
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Обычно основным предметом вожделения, испытываемого взломщиком парольной 
защиты операционной системы, являются административные полномочия. Их можно 
получить, узнав в хэшированием или символьном виде пароль администратора 
системы, который хранится в базе данных SAM. Поэтому именно на базу данных SAM 
бывает направлен главный удар взломщика парольной защиты Windows NT.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">По умолчанию в операционной системе Windows NT доступ к файлу \winnt_root\System32\Config\SAM 
заблокирован для всех без исключения ее пользователей. Тем не менее, с помощью программы NTBACKUP любой обладатель 
права на резервное копирование файлов и каталогов Windows NT может перенести 
этот файл с жесткого диска на магнитную ленту. Резервную копию реестра также 
можно создать утилитой REG ВАК из Windows NT Resource Kit. Кроме того, 
несомненный интерес для любого взломщика представляют резервная копия файла SAM 
(SAM.SAV) в каталоге \winnt_root\System32\Config и сжатая архивная копия SAM 
(файл SAM._) в каталоге \winnt_root\Repair.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">При наличии физической копии файла SAM извлечь хранимую в нем информацию не 
представляет никакого труда. Загрузив файл SAM в реестр любого другого 
компьютера с Windows NT (например, с помощью команды Load Hive программы 
REGEDT32), можно в деталях изучить учетные записи пользователей, чтобы 
определить значения RID пользователей и шифрованные варианты их хэшированных 
паролей. Зная RID пользователя и имея зашифрованную версию его хэшированного 
пароля, компьютерный взломщик может попытаться расшифровать этот пароль, чтобы 
использовать его, например, для получения сетевого доступа к другому компьютеру. 
Однако для интерактивного входа в систему одного лишь знания хэшированного 
пароля недостаточно. Необходимо получить его символьное представление.
</font></p>
</font>
<font face="Verdana, Arial, Helvetica, sans-serif" size="3">
</font>
<font face="Verdana, Arial, Helvetica, sans-serif" size="3">
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Для восстановления пользовательских паролей операционной системы Windows NT в 
символьном виде существуют специальные парольные взломщики, которые выполняют 
как прямой подбор паролей, так и поиск по словарю, а также используют 
комбинированный метод взлома парольной зашиты, когда в качестве словаря задействуется файл с заранее вычисленными 
хэшированными паролями, соответствующими символьным последовательностям, 
которые часто применяются в качестве паролей пользователей операционных систем. 
Одной из самых известных программ взлома паролей операционной системы Windows 
NT является LOphtCrack
<b>

(http://www.10pht.com/IOphtcrack/). 
</b>
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Другим распространенным парольным взломщиком Windows NT является Advanced NT 
Security Explorer (сокращенно — ANTExp). Его можно найти в Internet по адресу 
<b>
http://www.elcomsoft.com/antexp.html. 
</b>
ANTExp имеет удобный пользовательский 
интерфейс. Пользователь может задать набор символов, из которых будут 
формироваться последовательности, используемые в качестве вариантов паролей, а 
также верхнюю и нижнюю границу длины перебираемых паролей. Кроме того, можно 
выбрать тип атаки на парольную защиту Windows NT и применить либо атаку методом 
&quot;грубой силы&quot;, либо словарную атаку.
</font></p>
</font>
<font face="Verdana, Arial, Helvetica, sans-serif">
<b>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Защита системы от парольных взломщиков
</font></p>
</b>
</font>
<font face="Verdana, Arial, Helvetica, sans-serif" size="3">
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Итак, вывод однозначен: одна из главных задач системного администратора 
Windows NT состоит в защите от несанкционированного доступа той информации, 
которая хранится в базе данных SAM. С этой целью ему, прежде всего, необходимо 
ограничить физический доступ к компьютерам сети и прежде всего — к контроллерам 
доменов. Дополнительно, при наличии соответствующих программно-аппаратных 
средств, следует установить пароли BIOS на включение компьютеров и на изменение 
настроек BIOS. Затем, , используя настройки BIOS, рекомендуется отключить 
загрузку компьютеров с гибких и компакт-дисков. А для обеспечения контроля 
доступа к файлам и папкам операционной системы Windows NT системный раздел 
жесткою диска должен иметь формат NTFS.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Каталог \winnt_root\repair нужно средствами операционной системы закрыть для 
доступа всех пользователей, включая администраторов, и разрешать к ней доступ 
только во время работы утилиты RDISK, создающей в этом каталоге архивные копии 
системного реестра Windows NT. Системные администраторы также должны внимательно 
следить за тем, где и как хранятся дискеты аварийного восстановления (Emergency 
Repair Disks) и архивные копии на магнитных лентах, если на последних 
присутствует дубликат системного реестра Windows NT.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Если компьютер с операционной системой Windows NT входит в домен, то по 
умолчанию имена и хэшированные пароли последних 10-ти пользователей, 
регистрировавшихся на этом компьютере, сохраняются (кэшируются) в его локальном 
системном реестре (в разделе SECURITY\Policy\Secrets куста HKEY LOCAL_MACHINE). 
Чтобы отменить кэширование паролей на компьютерах домена, нужно с помощью 
утилиты REGEDT32 в раздел Micro-soft\WindowsNT\CurrentVersion\Winlogon куста 
HKEY_LOCAL MACHINE добавить параметр CashedLogonsCount, установив его значение 
равным нулю, а тип — REG_SZ.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Для защиты базы данных SAM можно применить утилиту SYSKEY, входящую в состав 
пакета обновления Windows NT Service Pack 3. Эта утилита позволяет 
включить режим дополнительного шифрования информации о паролях, которая 
хранится в базе данных SAM. Уникальный 128-битовый ключ для дополнительного 
шифрования паролей (так называемый 
<i>
ключ шифрования паролей — 
</i>
Password 
Encryption Key, РЕК) автоматически сохраняется в системном реестре для 
дальнейшего использования.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Перед помещением в системный реестр ключ РЕК шифруется при помощи Другого 
128-битового ключа, который называется системным ключом (System Key), и может 
храниться либо в системном реестре, либо в файле с именем STARTUP.KEY в корневом 
каталоге на отдельной дискете. Можно не сохранять системный ключ на магнитном 
носителе, и тогда каждый раз при запуске операционной системы он будет 
вычисляться с помощью алгоритма MD5 на основе пароля, набираемого на клавиатуре в диалоговом окне 
утилиты SYSKEY. Последние два способа хранения системного ключа обеспечивают 
максимальную защиту паролей в базе данных SAM, однако приводят к невозможности 
автоматической перезагрузки операционной системы, поскольку для завершения 
процесса перезагрузки потребуется либо вставить дискету с системным ключом и 
подтвердить ее наличие в дисководе путем нажатия кнопки ОК в появившемся 
диалоговом окне, либо вручную ввести системный ключ с клавиатуры.
</font></p>
</font>
<font face="Verdana, Arial, Helvetica, sans-serif" size="3">
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Для повышения стойкости паролей пользователей операционной системы Windows NT 
ко взлому рекомендуется с помощью утилиты Диспетчер пользователей (User Manager) 
задать минимальную длину пользовательских паролей равной не менее 8 символов и 
включить режим устаревания паролей, чтобы пользователи периодически их обновляли. При этом чем выше вероятность атак на парольную защиту Windows NT, 
тем короче должен быть срок такого устаревания. А чтобы пользователи не вводили 
свои старые пароли повторно, необходимо включить режим хранения некоторого числа 
ранее использовавшихся паролей.
</font></p>
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">Утилита PASSPROP из состава Windows NT Resource Kit, запущенная с ключом /COMPLEX, 
заставляет пользователей вводить более устойчивые пароли, которые или сочетают 
буквы в разном регистре, или буквы с цифрами, или буквы со специальными 
символами. Более строгие правила фильтрации нестойких паролей можно задать после 
установки любого из пакетов обновления Windows NT, начиная с Service Pack 2. 
Тогда специальная библиотека PASSFJLT.DLL, находящаяся в каталоге \winnt_root\System32, 
будет следить за тем, чтобы каждый пользовательский
</font>
<font face="Verdana, Arial, Helvetica, sans-serif">
</font>
<font face="Verdana, Arial, Helvetica, sans-serif" size="3">
<sub>
&nbsp;
</sub>
пароль состоял не менее чем из 5 символов, не содержал имени 
пользователя, включал символы, по крайней мере, трех наборов из четырех возможных, 
составленных из прописных букв, строчных букв, цифр и специальных символов 
(знаков препинания и т. д.) соответственно. Чтобы задать такой режим проверки 
паролей пользователей, необходимо в раздел HKEY_LOCAL_MACHINE\SYSTEM\CurrentControISet\Control\Lsa 
системного реестра с помощью программы REGEDT32 добавить параметр Noti
<span lang="en-us">
fi
</span>
cation Packages типа REG_MULTI_SZ и вписать в него строку PASSFILT Если этот 
параметр уже имеется, то новую строку следует дописать после уже существующей.
</font>
</p>
<font face="Verdana, Arial, Helvetica, sans-serif" size="3">
<p>
<font  face="Verdana, Arial, Helvetica, sans-serif">В заключение необходимо отметить, что хотя в умелых руках злоумышленника 
программы взлома паролей операционных систем представляют огромную опасность для 
их парольной защиты, сами парольные взломщики все же являются не менее ценным 
инструментом для системных администраторов, которые заинтересованы в выявлении 
слабых мест в парольной защите своих операционных систем. Основная проблема 
состоит не в том ч го на свете существуют парольные взломщики, а в том, что ими 
недостаточно часто пользуются системные администраторы. Надеюсь, что после выхода 
в свет этой книги положение дел изменится к лучшему.
</font>
<font face="Verdana, Arial, Helvetica, sans-serif">
</font>
</p>
<table width="14%" border="0" cellspacing="0">
<tr>
<td width="9%">
<font face="Verdana, Arial, Helvetica, sans-serif">
<a href="Index2.htm">
<img src="Back.gif" border="0" width="73" height="22">
</a>
</font>
</td>
<td width="45%">
<font face="Verdana, Arial, Helvetica, sans-serif">
<a href="../index.html">
<img src="Menu.gif" border="0" width="73" height="22">
</a>
</font>
</td>
<td width="46%">
<font face="Verdana, Arial, Helvetica, sans-serif">
<a href="Index4.htm">
<img src="For.gif" border="0" lowsrc="Index4.htm" width="73" height="22">
</a>
</font>
</td>
</tr>
</table>
</body>
</html>
